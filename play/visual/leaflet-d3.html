<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    
    <script src="js/d3.v3.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="features.js"></script>

    <style type="text/css">
      @import url('css/leaflet.css');

/*      body,
      #map {
        padding: 0;
        margin: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }*/

    #map {
      width: 960px;
      height: 500px;
    }

    </style>
  </head>
  <body>

    <div id="map"></div>

    <script>


      var map = new L.Map("map", {
            center: [37.7750, -122.4183],
            zoom: 12
          })
          .addLayer(new L.TileLayer("http://{s}.tile.cloudmade.com/1a1b06b230af4efdbb989ea99e9841af/998/256/{z}/{x}/{y}.png"));

      var svg = d3.select(map.getPanes().overlayPane).append("svg"),
          g = svg.append("g").attr("class", "leaflet-zoom-hide");


      var feats = {
        type: "FeatureCollection",
        features: featurez
      };
      // d3.json("us-states.json", function(collection) {
        var bounds = d3.geo.bounds(feats);
            // path = d3.geo.path().projection(project);


        // var feature = g.selectAll("path")
        //     .data(collection.features)
        //   .enter().append("path");

        map.on("viewreset", reset);
        map.on("move", reset);
        map.on("zoom", reset);
        reset();

        // Reposition the SVG to cover the features.
        function reset() {
          var bottomLeft = project(bounds[0]),
              topRight = project(bounds[1]);

          svg .attr("width", topRight[0] - bottomLeft[0])
              .attr("height", bottomLeft[1] - topRight[1])
              .style("margin-left", bottomLeft[0] + "px")
              .style("margin-top", topRight[1] + "px");

          g   .attr("transform", "translate(" + -bottomLeft[0] + "," + -topRight[1] + ")");

          g.selectAll("circle")
            .data(featurez)
          .enter().append("circle")
            .attr("cx", function(d) {
              d.coords = project(d.geometry.coordinates);
              return d.coords[0]; 
            })
            .attr("cy", function(d) { console.log(d.coords); return d.coords[1]; })
            .attr("fill", function(d) { return "hsl(" + Math.random() * 360 + ", 100%, 70%)"; })
            .attr("r", 5);

        }

        // Use Leaflet to implement a D3 geographic projection.
        function project(x) {
          var point = map.latLngToLayerPoint(new L.LatLng(x[1], x[0]));
          return [point.x, point.y];
        }
      // });

    </script>
  </body>
</html>