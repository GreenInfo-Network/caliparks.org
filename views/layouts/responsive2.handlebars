<!DOCTYPE html>
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Stamen Design">
    {{>meta-social}}

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="/style/responsive2-main.css" type="text/css" media="screen">
    <script src="//use.typekit.net/grl7dgh.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>

    {{>tracking}}
  </head>

  <body class="parksforward responsive2{{#if tabletViewport}} tablet-viewport{{/if}}" ontouchstart="" id="top">
    {{>social}}

    <div class="viewport-container{{#if view}}{{view}}{{/if}}">
      <header style="overflow:auto;">
        <p class="site-name"><a href="/">{{#__}}{{siteName}}{{/__}}</a></p>
        <div style="position:absolute;top:0;right:0;padding:5px 10px;">{{{theOtherLanguage}}}</div>
      </header>
      {{{body}}}
    </div>
    <footer>
      <section id="footer-actions">
        {{{theOtherLanguage}}}
        <a class="wander-action" href="/wander?from={{park_id}}">{{#__}}Wander{{/__}}</a>
        {{>uservoice}}
      </section>
      <section id="footer-credits">
        <div class="builtby">
          <h2>Built by</h2>
            <a href="http://stamen.com"><img class="stamen-logo" src="/style/responsive2/stamen-logo.svg" alt="Stamen"></a>
            <a href="http://www.greeninfo.org/"><img class="greeninfo-logo" src="/style/responsive2/greeninfo-logo.svg" alt="GreenInfo"></a>
            <a href="http://www.hipcamp.com/"><img class="hipcamp-logo" src="/style/responsive2/hipcamp-logo.svg" alt="hipcAmp"></a>
        </div>
        <div class="supportedby">
          <h2>Supported by</h2>
          <a href="http://www.parksforward.com/"><img class="parks-forward-logo" src="/style/logo-parks-forward.svg" alt="Parks Forward"></a>
          <a href="http://www.resourceslegacyfund.org/"><img class="rlf-logo" src="/style/rlf-logo.svg" alt="Resource Legacy Fund"></a>
        </div>
      </section>
    </footer>
    <!--[if lte IE 9]>
    <script src="/js/helpers/polyfills.js"></script>
    <![endif]-->
    <script src="/js/dist/vendor/require.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyCN-GnHQiVvap-YQh8QykZTxJTSLsxI2uw"></script>
    <script>

      "use strict";

      window.STMN = {};

      if (navigator.appVersion.indexOf("Win")!=-1) {STMN.OSName="Windows";}
      if (navigator.appVersion.indexOf("Mac")!=-1) {STMN.OSName="MacOS";}
      if (navigator.appVersion.indexOf("X11")!=-1) {STMN.OSName="UNIX";}
      if (navigator.appVersion.indexOf("Linux")!=-1) {STMN.OSName="Linux";}

      STMN.ua = (function(){
          var ua= navigator.userAgent, tem,
          M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
          if(/trident/i.test(M[1])){
              tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
              return 'IE '+(tem[1] || '');
          }
          if(M[1]=== 'Chrome'){
              tem= ua.match(/\bOPR\/(\d+)/)
              if(tem!= null) return 'Opera '+tem[1];
          }
          M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
          if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
          return M.join(' ');
      })();

      STMN.locale = "{{locale}}";

      if (typeof window.innerWidth === "number" && window.innerWidth < 720 && document.getElementsByTagName("body")[0].classList) {
        document.getElementsByTagName("body")[0].classList.add("rendered-narrow");
      }

      require.config({
        baseUrl     : "/js/dist",
        paths       : {
          "jquery"       : 'vendor/jquery/jquery-1.10.2',
          "attrchange"   : 'vendor/attrchange',
          "modernizr"    : '//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min',
          "handlebars"   : '//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min',
          "require-i18n" : "//cdnjs.cloudflare.com/ajax/libs/require-i18n/2.0.4/i18n"
        },
        waitSeconds : 15
      });

      'use strict';

      //
      // Set up URL hashing for Gmaps
      //
      (function(window) {

        function debounce(func, wait, immediate) {
        var timeout;
        return function() {
          var context = this, args = arguments;
          var later = function() {
            timeout = null;
            if (!immediate) {func.apply(context, args);}
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) {func.apply(context, args);}
            };
        }

        function UrlHash(map, config) {

          var init, center;

          function hasHash() {
            return (location.hash.length > 0);
          }

          function getUrlState() {
            var state = location.hash.substring(1).split('/').map(function(item) {
              return parseFloat(item, 10);
            });

            if (state.length === 3) {
              return state;
            } else {
              null;
            }
          }

          function setUrlState() {
            location.hash = '#' + getMapState().join('/');
            return getUrlState();
          }

          function getMapState() {

            center = map.getCenter();

            return [
              map.getZoom(),
              center.lat(),
              center.lng()
            ];
          }

          function setMapState() {
            center = getUrlState();
            if (center) {
              map.setZoom(center[0]);
              map.setCenter(new google.maps.LatLng(center[1], center[2]));
            }
          }

          google.maps.event.addListener(map, 'idle', function(e) {

            if(!init) {
              if(hasHash()) {
                setMapState();
              } else {
                setUrlState();
              }

              init = true;
            } else {
              setUrlState();
            }

          });

          window.onhashchange = debounce(setMapState, 500);

        };

        google.maps.UrlHash = UrlHash;

      }(window));

      {{#if view}}
      require( ["view_{{view}}"] );
      {{/if}}
    </script>

  </body>
</html>
